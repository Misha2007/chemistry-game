<!doctype html>
<html lang="et">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>Kokkuviimise mäng</title>
    <style>
      body {
        font-family: Arial;
        background: #0f2027;
        color: white;
        text-align: center;
        padding: 20px;
      }

      .back {
        font-size: 24px;
        cursor: pointer;
        text-align: left;
        display: block;
        margin-bottom: 20px;
        color: white;
        text-decoration: none;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        max-width: 600px;
        margin: auto;
      }

      .column {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .card {
        background: white;
        color: black;
        padding: 10px;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.3s;
      }

      .correct {
        background: #4caf50 !important;
        color: white;
      }

      .wrong {
        background: #e53935 !important;
        color: white;
      }

      .selected {
        background: #ffd54f !important;
      }
    </style>
  </head>
  <body>
    <a href="index.html" class="back">← Tagasi</a>

    <h2>Aine ja nimetuse kokkuviimine</h2>

    <div class="grid">
      <div class="column" id="formulas"></div>
      <div class="column" id="names"></div>
    </div>

    <script>
      var chemistryDict = {
        Lihtained: {
          Si: "Räni",
          He: "Heelium",
          Na: "Naatrium",
          Cu: "Vask",
          Au: "Kuld",
          H2: "Vesinik",
          O2: "Hapnik",
          Al: "Alumiinium",
          Fe: "Raud",
        },

        Oksiidid: {
          Na2O: "Naatriumoksiid",
          Al2O3: "Alumiiniumoksiid",
          P4O10: "Tetrafosfordekaoksiid",
          CO2: "Süsinikdioksiid",
          SO2: "Vääveldioksiid",
          NO2: "Lämmastikdioksiid",
          CaO: "Kaltsiumoksiid",
          SiO2: "Ränidioksiid",
          CO: "Süsinikoksiid",
        },

        Happed: {
          H2SO3: "Väävlishape",
          HNO3: "Lämmastikhape",
          H2SiO3: "Ränihape",
          HCl: "Vesinikkloriidhape",
          HF: "Vesinikfluoriidhape",
          H3PO4: "Fosforhape",
          H2CO3: "Süsihape",
        },

        Alused: {
          NaOH: "Naatriumhüdroksiid",
          "Al(OH)3": "Alumiiniumhüdroksiid",
          CuOH: "Vask(I)hüdroksiid",
          "Mg(OH)2": "Magneesiumhüdroksiid",
          KOH: "Kaaliumhüdroksiid",
        },

        Soolad: {
          NaCl: "Naatriumkloriid",
          AlCl3: "Alumiiniumkloriid",
          KNO3: "Kaaliumnitraat",
          MgCl2: "Magneesiumkloriid",
          CaCO3: "Kaltsiumkarbonaat",
          KI: "Kaaliumjodiid",
          KBr: "Kaaliumbromiid",
          NaNO2: "Naatriumnitrit",
          CaSO4: "Kaltsiumsulfaat",
          CuSO4: "Vask(II)sulfaat",
          Na2CO3: "Naatriumkarbonaat",
        },
      };

      var categories = Object.keys(chemistryDict);
      var currentLevel = 0;
      var selected = null;
      var lock = false;

      var formulasDiv = document.getElementById("formulas");
      var namesDiv = document.getElementById("names");
      var title = document.querySelector("h2");

      function formatFormula(text) {
        return text.replace(/(\d+)/g, "<sub>$1</sub>");
      }

      function loadLevel() {
        formulasDiv.innerHTML = "";
        namesDiv.innerHTML = "";
        selected = null;
        lock = false;

        var categoryName = categories[currentLevel];
        title.innerText = categoryName + " – Aine ja nimetuse kokkuviimine";

        var data = chemistryDict[categoryName];
        var pairs = Object.entries(data);

        var shuffledNames = [...pairs].sort(() => Math.random() - 0.5);

        // FORMULAS
        pairs.forEach(function (pair) {
          var div = document.createElement("div");
          div.className = "card";
          div.innerHTML = formatFormula(pair[0]);
          div.dataset.pair = pair[0];

          div.onclick = function () {
            if (selected || lock || div.classList.contains("correct")) return;
            selected = div;
            div.classList.add("selected");
          };

          formulasDiv.appendChild(div);
        });

        // NAMES
        shuffledNames.forEach(function (pair) {
          var div = document.createElement("div");
          div.className = "card";
          div.innerText = pair[1];
          div.dataset.pair = pair[0];

          div.onclick = function () {
            if (!selected || lock || div.classList.contains("correct")) return;

            lock = true;

            if (selected.dataset.pair === div.dataset.pair) {
              selected.classList.remove("selected");
              selected.classList.add("correct");
              div.classList.add("correct");

              selected = null;
              lock = false;

              checkLevelComplete();
            } else {
              selected.classList.add("wrong");
              div.classList.add("wrong");

              setTimeout(function () {
                selected.classList.remove("selected", "wrong");
                div.classList.remove("wrong");
                selected = null;
                lock = false;
              }, 800);
            }
          };

          namesDiv.appendChild(div);
        });
      }

      function checkLevelComplete() {
        var allCorrect = document.querySelectorAll(".card:not(.correct)");
        if (allCorrect.length === 0) {
          setTimeout(function () {
            currentLevel++;

            if (currentLevel < categories.length) {
              alert("Tase läbitud! Järgmine tase: " + categories[currentLevel]);
              loadLevel();
            } else {
              alert(" Kõik tasemed läbitud!");
            }
          }, 500);
        }
      }

      loadLevel();
    </script>
  </body>
</html>
